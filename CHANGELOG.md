# 📜 更新日志 (Changelog)

本项目遵循 [Semantic Versioning](https://semver.org/lang/zh-CN/) (语义化版本控制) 规范。

## [v4.3.0] - 2025-12-07 (最新版)
**🚀 性能重构与后台监控**
本次更新引入了后台服务进程，实现了不打开插件即可查看代理状态的功能，并大幅优化了规则匹配算法。

### ✨ 新增
- **实时状态图标**：引入 `background.js` (Service Worker)，浏览器图标会根据当前 Tab 的代理状态自动变色。
  - 🟢 **P (绿)**: 全局代理
  - 🟢 **A (绿)**: 自动模式 - 走代理
  - 🔘 **A (灰)**: 自动模式 - 直连
  - 🔵 **D (蓝)**: 全局直连
- **Canvas 绘图**：使用 `OffscreenCanvas` 动态绘制圆形图标，替代了之前巨大的文字 Badge。

### ⚡ 优化
- **算法升级**：将 GFWList 的匹配逻辑从 `Array.includes` (遍历查找) 升级为 `Set.has` (哈希查找)。
- **性能提升**：在大数据量(6000+条规则)下的匹配速度从 O(n) 提升至 **O(1)**，彻底解决访问百度等直连网站变慢的问题。
- **绘图缓存**：增加了状态缓存机制，避免重复绘制图标导致的 CPU 浪费。

### 🐛 修复
- 修复了端口输入框在出现滚动条时被遮挡的问题 (宽度增加至 380px)。

---

## [v4.2.0] - 2025-12-07
**🎨 UI 交互升级**
专注于提升用户界面的易用性和可视化体验。

### ✨ 新增
- **可视化规则管理**：新增了标签(Tag)云样式的规则列表，支持一键点击 `×` 删除。
- **状态面板**：在插件顶部蓝色区域增加“当前策略”显示（明确显示是“命中规则”还是“未命中”）。
- **手动添加**：增加了手动输入域名并回车添加的输入框。

### 💄 样式
- 优化了 Flex 布局，防止 IP 输入框在窄屏下变形。

---

## [v4.1.0] - 2025-12-07
**🛠️ 稳定性修复**
解决了新功能引入的边界情况 Bug。

### 🐛 修复
- 修复了在“新标签页(New Tab)”或“系统设置页”点击插件时，因读取不到 URL 导致的 `startsWith undefined` 报错崩溃问题。
- 增加了 URL 协议安全检查，只处理 `http/https` 页面。

---

## [v4.0.0] - 2025-12-07
**🧠 智能交互功能**
引入了与当前浏览器标签页的交互能力。

### ✨ 新增
- **快捷添加**：自动识别当前网页域名。
- **智能按钮**：如果当前域名已在列表中，按钮自动变为“移除”；否则显示“添加”。
- **双重规则合并**：实现了 `用户自定义规则` + `GFWList` 的自动去重合并 PAC 生成逻辑。

### 🔧 权限
- `manifest.json` 新增 `"tabs"` 权限以读取当前网址。

---

## [v3.0.0] - 2025-12-07
**🧱 GFWList 集成**
实现了规则列表的本地化处理，不再依赖在线 PAC。

### ✨ 新增
- **一键更新**：支持从 GitHub 下载最新的 GFWList。
- **本地解析**：内置 Base64 解码和规则清洗逻辑，提取有效域名存入 LocalStorage。
- **离线使用**：规则下载后永久缓存，无需每次联网。

### 🐛 修复
- 修复了 PAC 脚本中包含非 ASCII 字符（如中文注释）导致 Chrome 代理报错的问题。
- 强制过滤非标准域名，防止脚本语法错误。

---

## [v2.0.0] - 2025-12-07
**🤖 PAC 自动分流**
引入了 PAC (Proxy Auto-Config) 机制。

### ✨ 新增
- 支持 **PAC (自动分流)** 模式。
- 实现了基础的 PAC 脚本生成器 (`FindProxyForURL` 函数)。
- 支持在 HTTP 和 SOCKS5 代理协议之间切换。

---

## [v1.0.0] - 2025-12-07
**🌱 初始发布 (MVP)**
一个极简的代理切换工具。

### ✨ 功能
- 支持 **全局代理** (Fixed Servers) 模式。
- 支持 **直连** (Direct) 模式。
- 基础的 IP 和端口配置保存。
- 原生 HTML/JS 实现，无任何框架依赖。

---
